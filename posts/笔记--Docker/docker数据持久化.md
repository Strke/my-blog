在容器层的 UnionFS(联合文件系统) 中对文件/目录的任何修改，无论是手工修改还是容器在运行过程中的修改，在该容器丢失或被删除后这些修改将全部丢失。即这些修改是无法保存下来的。若要保存下来这些修改，通常有两种方式:

* 定制镜像持久化:将这个修改过的容器生成一个新的镜像，让这些修改变为只读的镜像.
* 数据卷持久化:将这些修改通过数据卷同步到宿主机

### 定制镜像持久化

```dockerfile
docker commit -m="xxxx" -a="xxx" mytom tomcat10:own
```

使用docker commit将对容器的修改保存为镜像



### 数据卷

Docker的三种同步方式（宿主机与容器文件系统间的数据同步）：

* 数据卷
* Bind mounts（绑定挂载）
* tmpfs（临时文件系统）

数据卷是宿主机中的一个特殊的文件/目录，这个文件/目录与容器中的另一个文件/目录进行了直接关联，在任何一端对文件/目录的写操作，在另一端都会同时发生相应变化。在宿主中的这个文件/目录就称为数据卷，而容器中的这个关联文件/目录则称为该数据卷在该容器中的挂载点。
数据卷的设计目的就是为了实现数据持久化，其完全独立于容器的生命周期，属于宿主机文件系统，但不属于 UnionFS。因此，容器被删除时，不会删除其挂载的数据卷。

数据卷具有如下明显特性:“

* 数据卷在容器启动时初始化，如果容器启动后容器本身已经包含了数据，那么，这些数据会在容器启动后直接出现在数据卷中，反之亦然。
* 可以对数据卷或挂载点中的内容直接修改，修改后对方立即可看到
* 数据卷会一直存在，即使挂载数据卷的容器已经被删除“
* 数据卷可以在容器之间共享和重用

#### 创建读写数据卷

**宿主机目录绝对路径**或者**容器内目录绝对路径**不存在时，都会自动创建。

```bash
docker run -it -v /宿主机目录绝对路径:/容器内目录绝对路径 镜像
```



#### 创建只读数据卷

为了防止容器在运行过程中修改文件，这时需要创建只读数据卷

```bash
docker run -it -v /宿主机目录绝对路径:/容器内目录绝对路径:ro 镜像
```

#### 数据卷共享

指的是两个容器使用相同的数据卷时

```bash
docker run -it --volumes-from[容器C] 镜像
```

通过这种方式创建的容器可以共享容器C挂载的数据卷。容器C也就是数据卷容器。

#### 共享方式

![](C:\Users\lin\Desktop\笔记--Docker\pic\微信图片_20231130062337.png)

避免使用应用程序容器作为数据卷容器，使用数据卷容器可以避免以下问题：

* 避免由于容器被删除而导致挂载到这个容器的容器无法使用。



### Dockerfile持久化

Dockerfile 持久化,其实就是通过使用 Dockerfile 的 VOLUME 指令指定数据卷方式实现的持久化。

VOLUME 指令今可以在容器中创建可以挂载数据卷的挂载点。其参数可以是字符串数组，也可以是使用空格隔开的多个纯字符串。例如，VOLUME["/var/www”,"/etc/apache”] 或

VOLUME /var/www /etc/apache。

```Docke
FROM centos:7
VOLUME /opt/xx /opt/ooo
CMD /bin/bash
```

